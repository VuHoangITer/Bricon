{% extends "base.html" %}

{% block title %}{{ job.title }} - Tuyển dụng - {{ get_setting('website_name', 'BRICON VIỆT NAM') }}{% endblock %}
{% block meta_description %}{{ job.title }} - {{ get_setting('website_name', 'BRICON VIỆT NAM') }}. {{ job.location }}. Mức lương: {{ job.salary }}. Ứng tuyển ngay!{% endblock %}

{% block content %}
<!-- ==================== BREADCRUMB & PAGE HEADER ==================== -->
<div class="page-header bg-light py-4">
    <div class="container">
        <h1 class="fw-bold mb-3">{{ job.title }}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('main.careers') }}">Tuyển dụng</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ job.title[:50] }}{% if job.title|length > 50 %}...{% endif %}
                </li>
            </ol>
        </nav>
    </div>
</div>
<!-- Job Detail -->
<section class="job-detail py-5" itemscope itemtype="https://schema.org/JobPosting">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <!-- Job Header -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h2 class="h3 mb-2" itemprop="title">{{ job.title }}</h2>
                                {% if job.is_urgent %}
                                <span class="badge bg-danger mb-2">
                                    <i class="bi bi-lightning-fill"></i> Tuyển gấp
                                </span>
                                {% endif %}
                            <meta itemprop="datePosted" content="{{ job.created_at|vn_datetime('%Y-%m-%d') if job.created_at else '' }}">
                            {% if job.deadline %}
                            <meta itemprop="validThrough" content="{{ job.deadline|vn_datetime('%Y-%m-%d') }}">
                                {% endif %}
                            </div>
                            {% if not job.is_expired() %}
                            <span class="badge bg-success">Đang tuyển</span>
                            {% else %}
                            <span class="badge bg-secondary">Đã đóng</span>
                            {% endif %}
                        </div>

                        <div class="row g-3 mb-4">
                            {% if job.department %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-briefcase text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Phòng ban</small>
                                        <strong>{{ job.department }}</strong>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="col-md-6" itemprop="jobLocation" itemscope itemtype="https://schema.org/Place">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-geo-alt text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Địa điểm</small>
                                        <strong itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
                                            <span itemprop="addressLocality">{{ job.location }}</span>
                                            <meta itemprop="addressCountry" content="VN">
                                        </strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clock text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Hình thức</small>
                                        <strong itemprop="employmentType">{{ job.job_type }}</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-bar-chart text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Cấp bậc</small>
                                        <strong>{{ job.level }}</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" itemprop="baseSalary" itemscope itemtype="https://schema.org/MonetaryAmount">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-cash-stack text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Mức lương</small>
                                        <strong class="text-success">
                                            <span itemprop="value">{{ job.salary }}</span>
                                        </strong>
                                        <meta itemprop="currency" content="VND">
                                    </div>
                                </div>
                            </div>
                            {% if job.experience %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-award text-warning fs-4 me-3"></i>
                                    <div>
                                        <small class="text-muted d-block">Kinh nghiệm</small>
                                        <strong itemprop="experienceRequirements">{{ job.experience }}</strong>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        {% if job.deadline and not job.is_expired() %}
                        <div class="alert alert-warning">
                            <i class="bi bi-calendar-event"></i>
                            <strong>Hạn nộp hồ sơ:</strong> {{ job.deadline|vn_date }}
                        </div>
                        {% endif %}

                        <!-- Hidden Schema.org Organization -->
                        <div itemprop="hiringOrganization" itemscope itemtype="https://schema.org/Organization" style="display:none;">
                            <span itemprop="name">{{ get_setting('website_name', 'BRICON VIỆT NAM') }}</span>
                            <link itemprop="url" href="{{ get_setting('main_url', request.url_root) }}">
                            <link itemprop="logo" href="{{ get_setting('logo_url', url_for('static', filename='img/logo.png', _external=True)) }}">
                        </div>
                    </div>
                </div>

                <!-- Job Description -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-file-text"></i> Mô tả công việc
                        </h5>
                        <div class="job-description" itemprop="description">
                            {{ job.description|safe }}
                        </div>
                    </div>
                </div>

                <!-- Requirements -->
                {% if job.requirements %}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-check2-square"></i> Yêu cầu ứng viên
                        </h5>
                        <div class="requirements" itemprop="qualifications">
                            {{ job.requirements|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Benefits -->
                {% if job.benefits %}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-gift"></i> Quyền lợi
                        </h5>
                        <div class="benefits" itemprop="jobBenefits">
                            {{ job.benefits|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Apply CTA -->
                {% if not job.is_expired() %}
                <div class="card border-0 shadow-sm bg-warning">
                    <div class="card-body text-center py-4">
                        <h4 class="mb-3">Bạn quan tâm đến vị trí này?</h4>
                        <p class="mb-4">Hãy gửi CV của bạn cho chúng tôi ngay hôm nay!</p>
                        <a href="mailto:{{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}?subject=Ứng tuyển {{ job.title }}"
                           class="btn btn-dark btn-lg">
                            <i class="bi bi-envelope"></i> Gửi CV ngay
                        </a>
                        <p class="small text-muted mt-3 mb-0">
                            Email: {{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}
                        </p>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-secondary text-center">
                    <i class="bi bi-info-circle"></i> Vị trí này đã hết hạn nộp hồ sơ
                </div>
                {% endif %}
            </div>

      <!-- Sidebar -->
<div class="col-lg-4">
    <div class="sidebar-wrapper">
    <!-- Quick Apply -->
    {% if not job.is_expired() %}
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0"><i class="bi bi-send"></i> Ứng tuyển nhanh</h5>
        </div>
        <div class="card-body">
            <form action="mailto:{{ job.contact_email or get_setting('contact_email', 'info@hoang.vn') }}" method="get" enctype="text/plain">
                <input type="hidden" name="subject" value="Ứng tuyển {{ job.title }}">

                <div class="mb-3">
                    <label class="form-label">Họ tên *</label>
                    <input type="text" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Số điện thoại *</label>
                    <input type="tel" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">CV đính kèm</label>
                    <input type="file" class="form-control" accept=".pdf,.doc,.docx">
                    <small class="text-muted">PDF, DOC, DOCX (Max 5MB)</small>
                </div>

                <button type="submit" class="btn btn-warning w-100">
                    <i class="bi bi-send"></i> Gửi hồ sơ
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Contact Info -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-info-circle"></i> Liên hệ</h6>
        </div>
        <div class="card-body">
            <p class="mb-2 text-center">
                <i class="bi bi-telephone text-warning"></i>
                <strong>Hotline:</strong>
                <a href="tel:{{ get_setting('hotline', '0901180094')|replace('.', '')|replace(' ', '') }}" 
                class="text-decoration-none text-primary fw-bold">
                {{ get_setting('hotline', '0901.180.094') }}
                </a>
            </p>
            <p class="mb-2 text-center">
                <i class="bi bi-envelope text-warning"></i>
                <strong>Email:</strong>
                <a href="mailto:{{ get_setting('contact_email', 'info@hoang.vn') }}" class="text-decoration-none text-primary fw-bold">
                    {{ get_setting('contact_email', 'info@hoang.vn') }}
                </a>
            </p>
            <p class="mb-0 text-center">
                <i class="bi bi-geo-alt text-warning"></i>
                <strong>Địa chỉ:</strong>
                {{ get_setting('address', '982/l98/a1 Tân Bình, Tân Phú Nhà Bè') }}
            </p>
        </div>
    </div>
    </div>
</div>

                <!-- Other Jobs -->
                {% if other_jobs %}
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="bi bi-briefcase"></i> Vị trí khác</h6>
                    </div>
                    <div class="list-group list-group-flush">
                        {% for other in other_jobs %}
                        <a href="{{ url_for('main.job_detail', slug=other.slug) }}"
                           class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <strong class="d-block">{{ other.title }}</strong>
                                    <small class="text-muted">
                                        <i class="bi bi-geo-alt"></i> {{ other.location }}
                                    </small>
                                </div>
                                {% if other.is_urgent %}
                                <span class="badge bg-danger">Gấp</span>
                                {% endif %}
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    <div class="card-footer bg-white">
                        <a href="{{ url_for('main.careers') }}" class="btn btn-outline-warning w-100">
                            Xem tất cả <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- ==================== SCHEMA.ORG - BREADCRUMB ==================== -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Trang chủ",
      "item": "{{ url_for('main.index', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Tuyển dụng",
      "item": "{{ url_for('main.careers', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ job.title|e }}",
      "item": "{{ url_for('main.job_detail', slug=job.slug, _external=True) }}"
    }
  ]
}
</script>
{% endblock %}

{% block extra_css %}
<style>
.job-description ul,
.requirements ul,
.benefits ul {
    list-style: none;
    padding-left: 0;
}

.job-description ul li,
.requirements ul li,
.benefits ul li {
    padding-left: 1.5em;
    position: relative;
    margin-bottom: 0.5rem;
}

.job-description ul li:before,
.requirements ul li:before,
.benefits ul li:before {
    content: "\F26B";
    font-family: "bootstrap-icons";
    color: #ffc107;
    position: absolute;
    left: 0;
}
</style>
<!-- CSS cho sticky sidebar với scroll -->
<style>
.sidebar-wrapper {
    position: sticky;
    top: 120px; /* Khoảng cách từ navbar */
    max-height: calc(100vh - 110px); /* Chiều cao tối đa = viewport - (top + padding) */
    overflow-y: auto; /* Cho phép scroll nếu nội dung dài */
    padding-bottom: 20px;
}

/* Ẩn thanh scrollbar nhưng vẫn scroll được - ĐANG BẬT */
/* Muốn HIỆN lại thanh scroll: Xóa 2 dòng dưới */
.sidebar-wrapper::-webkit-scrollbar {
    display: none; /* Ẩn scrollbar trên Chrome, Safari, Edge */
}

.sidebar-wrapper {
    -ms-overflow-style: none;  /* Ẩn scrollbar trên IE, Edge cũ */
    scrollbar-width: none;  /* Ẩn scrollbar trên Firefox */
}

/* Custom scrollbar cho sidebar - ĐANG TẮT */
/* Bỏ comment dòng dưới để BẬT lại thanh scroll màu vàng (nhớ xóa phần ẩn scrollbar ở trên) */
/*
.sidebar-wrapper::-webkit-scrollbar {
    width: 6px;
}

.sidebar-wrapper::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.sidebar-wrapper::-webkit-scrollbar-thumb {
    background: #FFC107;
    border-radius: 10px;
}

.sidebar-wrapper::-webkit-scrollbar-thumb:hover {
    background: #FFB300;
}
*/

/* Tắt sticky trên mobile */
@media (max-width: 991.98px) {
    .sidebar-wrapper {
        position: static;
        max-height: none;
        overflow-y: visible;
    }
}
</style>
<style>
a.text-primary.fw-bold:hover {
  color: #004085 !important; /* xanh đậm hơn khi hover */
  text-decoration: underline; /* nếu anh muốn có gạch chân nhẹ */
  transition: 0.2s ease;
}
</style>
{% endblock %}